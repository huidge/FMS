<#--
        * description: 渠道供应商产品关系
        * version: 1.0
        * author: tao.wei@hand-china.com
        * -->
<#include "../include/header.html">
<script src="${base.contextPath}/clb/common/clbCode?classTypeOne=CNL.CHANNEL_CLASS" type="text/javascript"></script>
<body>
<script type="text/javascript">
var prdItemsDivision;
var prdItemsClass;
var prdItemsCatagory;
var viewModel = kendo.observable({
    model         : {},
    createFunction: function(){
        $('#Grid').data('kendoGrid').addRow();
    },
    saveFunction: function(){
    	var dataSource = $('#Grid').data('kendoGrid').dataSource;
	    $('#Grid').data('kendoGrid').saveChanges();
	    alert("1111");
    },
    queryFunction: function (e) {
        $('#Grid').data('kendoGrid').dataSource.page(1);
    },
    cancelChanges: function(){
        $('#Grid').data('kendoGrid').cancelChanges();
    },
    resetForm : function(e) {
        var formData = viewModel.model.toJSON();
        for ( var k in formData) {
            viewModel.model.set(k, null);
        }
   }
});

/* function validate(){
	var data = $('#grid').data('kendoGrid').dataItems();
	var bool = true;
	var temp = data[0];
	for(var j=1;j<data.length;j++){
		if(temp.channelClassCode == data[j].channelClassCode  && temp.channelId == data[j].channelId && temp.supplierId == data[j].supplierId && temp.bigClass == data[j].bigClass && temp.midClass == data[j].midClass && temp.minClass == data[j].minClass && temp.prdSupplierId == data[j].prdSupplierId && temp.productId == data[j].productId && temp.contributionPeriod == data[j].contributionPeriod){
			bool = false;
			return bool;
		}
	}
	return bool;
}; */

/* //保存
function saveChanges(){
	if(validate()){
		$('#grid').data('kendoGrid').saveChanges();
		$('#grid').data('kendoGrid').dataSource.page(dataSource._page);
	}else{
		kendo.ui.showErrorDialog({
            title:$l('hap.tip.info'),
            message: "该记录已存在,保存失败！"
        })
	}
} */








</script>
<div id="importDialog1" style="display: none;"></div>
	<!-- view层 -->
	<div id="importDialog1" style="display: none;"></div>
	<div class="content-container">
		<div id="page-content">
		    <div class="panel">
            <form class="form-horizontal" id="myForm">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="col-sm-4 control-label">供应商名称</label>
                                <div class="col-sm-8">
                                    <input  style="width: 100%" id="name"
                                           data-bind="value:model.supplierId" >
                                </div>
                                <script>
                                        $("#name").kendoLov($.extend(${lovProvider.getLov(base.contextPath, base.locale, "SPE_SUPPLIER_NAME")}, {
                                        }))
			                    </script>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="col-sm-4 control-label">产品大分类</label>
                                <div class="col-sm-8">
                                   <input type="text" style="width: 100%"
                                           data-text-field="meaning" data-value-field="value" data-value-primitive="true"
                                           data-bind="source: prdItemsDivision,value:model.bigClass" id="bigClass" >
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="col-sm-4 control-label">产品中分类</label>
                                <div class="col-sm-8">
                                   <input type="text" style="width: 100%"
                                           data-text-field="meaning" data-value-field="value" data-value-primitive="true"
                                           data-bind="source: prdItemsClass,value:model.midClass" id="midClass" >
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="col-sm-4 control-label">产品小分类</label>
                                <div class="col-sm-8">
                                    <input type="text" style="width: 100%"
                                           data-text-field="meaning" data-value-field="value" data-value-primitive="true"
                                           data-bind="source: prdItemsCatagory,value:model.minClass" id="minClass" >
                                </div>
                            </div>
                        </div>
                    </div><!-- row end -->
                    <div class="row">
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="col-sm-4 control-label">产品公司</label>
                                <div class="col-sm-8">
                                    <input type="text" style="width: 100%"
                                           data-bind="value:model.prdSupplierId" id="prdSupplierId" >
                                    <script>
                                        $("#prdSupplierId").kendoLov($.extend(${lovProvider.getLov(base.contextPath, base.locale, "PRD_SUPPLIER_NAME")}, {
                                            query: function (e) {}
                                        }));
                                    </script>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="col-sm-4 control-label">产品名称</label>
                                <div class="col-sm-8">
                                    <input style="width: 100%" id="itemCode"
                                           data-bind="value:model.itemCode">
                                </div>
                            </div>
                              <script>
                                        $("#itemCode").kendoLov($.extend(${lovProvider.getLov(base.contextPath, base.locale, "PRD_ITEMS")}, {
                                        }))
			                    </script>
                        </div>
                        <!--  <div class="col-sm-3">
                            <div class="form-group">
                                <label class="col-sm-4 control-label">渠道分类</label>
                                <div class="col-sm-8">
                                     <select data-role="combobox" data-value-primitive="true" style="width:100%;"
										data-text-field="meaning" data-value-field="value"
										data-bind="source: classTypeOneCom, value: model.channelClassCode"></select>
                                </div>
                            </div>
                        </div> -->
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="col-sm-4 control-label">渠道名称</label>
                                <div class="col-sm-8">
                                    <input  style="width: 100%" id="channelName"
                                           data-bind="value:model.channelName" >
                                </div>
                                <script>
                                        $("#channelName").kendoLov($.extend(${lovProvider.getLov(base.contextPath, base.locale, "CMN_CHANNEL")},
                                        {
                                        	select:function(e){
                                        		viewModel.model.set('channelId', e.item.channelId);
                                        		viewModel.model.set('channelName', e.item.channelName);
            				                }
                                        }))
			                    </script>
                            </div>
                        </div>
                    </div><!-- row end -->
                    </div><!-- panel-body end -->
                          <div class="panel-footer text-right">
                            <span class="btn btn-primary" data-bind="click:queryFunction" type="submit">
                                <i class="fa fa-search"
                                   style="margin-right:3px;"></i><@spring.message "hap.query"/></span>
                            <span class="btn btn-default" type="button" data-bind="click:resetForm">
                                <i class="fa fa-eraser"
                                   style="margin-right:3px;"></i><@spring.message "hap.reset"/></span>
                        </div>

            </form>
        </div>

<!--         <form>
           <div >
               <input type="file" name="files" id="importExcelFile" style="float:left" onclick="importExcel1()">
           </div>
        </form> -->

			<div>
				<div id="grid" class="table"></div>
			</div>

		</div>
	</div>


	<script type="text/javascript">
 	kendo.bind($('#page-content'), viewModel);

/*  	$(function(){
		//页面加载完成之后   判断是否有权限去导入数据
		 $.ajax({
		   url:"${base.contextPath}/clb/sys/user/isImporter",
		   method:"POST",
		   contentType:"application/json",
		   dataType:"json",
		   data:{},
		   success:function (data) {
			   if(data){
				   $("#importExcelBtn1").show();
			   }else{
				   $("#importExcelBtn1").hide();
			   }
		   }
	   });
	}) */

 	 //产品大分类
    $.ajax({
        type:"POST",
        url:"${base.contextPath}/clb/common/lov/PRD_DIVISION?pagesize="+1000,
        contentType:"application/json",
        data:{"statusCode":"Y"},
        success: function(e) {
            prdItemsDivision = e.rows;
            viewModel.set("prdItemsDivision", prdItemsDivision);
        }
    });
    $("#bigClass").kendoDropDownList({
        dataTextField: "meaning",
        dataValueField: "value",
        dataSource: prdItemsDivision,
        optionLabel:'--产品大分类--',
        select:function(e){
            //产品中分类
            $.ajax({
                type:"POST",
                async:false,
                url:"${base.contextPath}/clb/common/lov/PRD_CLASS?pagesize="+1000,
                contentType:"application/x-www-form-urlencoded",
                data:{"statusCode":"Y","className1":e.dataItem.value},
                success: function(e) {
                    prdItemsClass = e.rows;
                    viewModel.set("prdItemsClass", prdItemsClass);

                    viewModel.model.set('midClass', null);
                    viewModel.model.set('minClass', null);
                }
            });
            //产品小分类
            $.ajax({
                type:"POST",
                async:false,
                url:"${base.contextPath}/clb/common/lov/PRD_CATAGORY?pagesize="+1000,
                contentType:"application/x-www-form-urlencoded",
                data:{"statusCode":"Y","className1":e.dataItem.value },
                success: function(e) {
                    prdItemsCatagory = e.rows;
                    viewModel.set("prdItemsCatagory", prdItemsCatagory);
                }
            });
        }
    });
    //产品中分类
    $.ajax({
        type:"POST",
        url:"${base.contextPath}/clb/common/lov/PRD_CLASS?pagesize="+1000,
        contentType:"application/json",
        data:{"statusCode":"Y"},
        success: function(e) {
            prdItemsClass = e.rows;
            viewModel.set("prdItemsClass", prdItemsClass);
            viewModel.model.set('minClass', '');
        }
    });
    $("#midClass").kendoDropDownList({
        dataTextField: "meaning",
        dataValueField: "value",
        dataSource: prdItemsClass,
        optionLabel:'--产品中分类--',
        select:function(e){
            //产品小分类
            $.ajax({
                type:"POST",
                async:false,
                url:"${base.contextPath}/clb/common/lov/PRD_CATAGORY?pagesize="+1000,
                contentType:"application/x-www-form-urlencoded",
                data:{"statusCode":"Y","className2":e.dataItem.value,"className1":$("#bigClass").val() },
                success: function(e) {
                    prdItemsCatagory = e.rows;
                    viewModel.set("prdItemsCatagory", prdItemsCatagory);
                }
            });
        }
    });
    //产品小分类
    $.ajax({
        type:"GET",
        url:"${base.contextPath}/clb/common/lov/PRD_CATAGORY?pagesize="+1000,
        contentType:"application/json",
        success: function(e) {
            prdItemsCatagory = e.rows;
            viewModel.set("prdItemsCatagory", prdItemsCatagory);
        }
    });
    $("#minClass").kendoDropDownList({
        dataTextField: "meaning",
        dataValueField: "value",
        dataSource: prdItemsCatagory,
        optionLabel:'--产品小分类--',
    });
/*     function importExcel1(){
        var url = '${base.contextPath}/fnd/import/import_upload.html?className=clb.core.channel.service.impl.CnlChannelImport';
        var importDialog = $("#importDialog1").kendoWindow({
            actions: ["Close"],
            width: '100%',
            height: '100%',
            title: '<@spring.message "fms.data_import"/>',
            content: url,
            iframe: true,
            visible: false,
            modal: true,
            close: function () {
                //window 关闭  刷新本页面的grid
                $('#grid').data('kendoGrid').dataSource.page(1);
            }
        }).data("kendoWindow");
        importDialog.maximize();
        importDialog.center().open();
    } */

 	/* $("#importExcelFile").kendoUpload({
 	    async:{
 	        saveUrl: "${base.contextPath}/cnlProSupRelation/import?${_csrf.parameterName}=${_csrf.token}",
 	        autoUpload: false
 	    },
 	    multiple: false,
 	    localization: {
 	        select: "批量导入",
 	        uploadSelectedFiles: "上传",
 	        headerStatusUploading: "上传中...",
 	        headerStatusUploaded: "文件上传成功!"
 	    },
 	    error:function (e) {
 	    	console.log(1,e)
 	    	kendo.ui.showErrorDialog({
 	            title: '提示信息',
 	            message: '导入失败!<br/>' + e.XMLHttpRequest.status + '<br/>' + e.XMLHttpRequest.responseURL
 	        });
 	    },
 	    success:function (e) {
 	    	if(e.response.success){
 	             kendo.ui.showInfoDialog({
 	                 title: '提示信息',
 	                 message: '添加成功'
 	             }).done(function (event) {
 	                 if (event.button == 'OK') {
 	                      window.parent.$("#excelWindow").data("kendoWindow").close();
 	                      window.parent.$("#grid").data("kendoGrid").dataSource.page(1);
 	                 }
 	             });
 	        }else{
 	             kendo.ui.showErrorDialog({
 	                 title: '导入失败',
 	                 message: e.response.message
 	             });

 	        }
 	    }
 	}); */

 	 //　导入excel
/*     function importExcel1(){
        var url = '${base.contextPath}/fnd/import/import_upload.html?className=clb.core.channel.service.impl.CnlProSupRelationImport2';
        var importDialog = $("#importDialog1").kendoWindow({
            actions: ["Close"],
            width: '100%',
            height: '100%',
            title: '<@spring.message "fms.data_import"/>',
            content: url,
            iframe: true,
            visible: false,
            modal: true,
            close: function () {
                //window 关闭  刷新本页面的grid
                $('#grid').data('kendoGrid').dataSource.page(1);
            }
        }).data("kendoWindow");
        importDialog.maximize();
        importDialog.center().open();
    }
 	 */
 	$('#query-form input').keydown(function (e) {
 		if (e.keyCode == 13) {
 			e.target.blur();
 			viewModel.queryFunction(e);
 		}
 	});



 	/* function excelOut(){
 		 window.location.href="${base.contextPath}/cnlProSupRelation/templateExcelOut";
 	} */

 		//向后台进行数据交互
 			   	BaseUrl = "${base.contextPath}/cnlProSupRelation/";
 			    var dataSource = new kendo.data.DataSource(
 					{
 						transport : {
 							read : {
 								url : BaseUrl + "query",
 								type : "POST",
 								dataType : "json"
 							},
 							create : { //增
 	 		                  url : BaseUrl + "submit",
 	 		                  contentType: "application/json",
 	 		                  type : "POST"
 	 		              },
 	 		              update : { //改
 	 		                  url :BaseUrl + "submit",
 	 		                  contentType: "application/json",
 	 		                  type : "POST"
 	 		              },
 	 		              destroy : { //删
 	 		                   url :BaseUrl + "remove",
 	 		                   contentType: "application/json",
 	 		                   type : "POST"
 	 		              },
 							parameterMap : function(options,
 									type) {
 								 /* 非查询 */
 		    		          	if (type !== "read" && options.models) {
 		    		                   var datas = Hap.prepareSubmitParameter(options, type);
 		    		                   return kendo.stringify(datas);
 		    		               }
 		    		          	else if(type == "read") {
 									 return Hap.prepareQueryParameter(viewModel.model.toJSON(), options);
 								}
 							}

 						},
 						batch : true,
 						serverPaging : true,
 						pageSize : 10,
 						schema : {
 						data:'rows',
 	 		            total:'total',
 							model : {
 								id : "id",
 								fields : {
 									// supplierCode:{validation:{required:true}},
 									bigClass:{validation:{required:true}},
 			                    	midClass:{},
 			                    	minClass:{},
 			                    	itemId:{},
 			                    	prdSupplierId : {validation:{required:true}},
 									//channelClassCode: {validation:{required:true}},
 									channelName: {validation:{required:true}},
 									channelCode: {validation:{required:true}}
 								},
 							}
 						}
 					});

 			$("#grid").kendoGrid({
 				dataSource : dataSource,
 				editable:true,
 				navigatable : false,
 				selectable: "multiple, row",
 				resizable : true,
 				height: '430px',
 				sortable: true,
 				rownumber: true,
 				scrollable : true,
 				selectable: 'multiple, rowbox',
 				pageable : {
 					pageSizes : [ 5, 10, 20, 50 ],
 					refresh : true,
 					buttonCount : 5
 				},
 				toolbar: [
 				            /* {
 	                             template: '<span class="btn btn-primary" style="float: left; margin-right: 5px;" onclick="excelOut()">' +
 	                             '导入模板下载</span>'
 	                        }, */
 	                        //用户计划书初始额度导入1
 	                         /* {
 	                        	template: '<span id="importExcelBtn1" style="float:left;margin-right:5px;" class="btn btn-primary" onclick="importExcel1()">'+
 	                    			'<i class="fa fa-file-excel-o" style="margin-right:3px;"></i>信息导入</span>',
 	                        },  */
 		                    {
 			                     template: '<span class="btn btn-primary k-grid-add" style="float: left; margin-right: 5px;" data-bind="click:createFunction" id = "aa">' +
 			                     '<i class="fa fa-plus-square" style="margin-right: 3px;"></i><@spring.message "hap.new"/></span>'
 		                    },
 		                     {
 		                        name: "save",
 		                        template: '<span class="btn btn-success"  onclick="save();">' +
 		                        '<i class="fa fa-save" style="margin-right:3px;"></i><@spring.message "hap.save"/></span>'
 		                    },
 		                    /* {
 		                        name: "save",
 		                        template: '<span class="btn btn-success k-grid-save-changes" data-bind="click:saveFunction">' +
 		                        '<i class="fa fa-save" style="margin-right:3px;"></i><@spring.message "hap.save"/></span>'
 		                    }, */
 		                    {
 		                        template: '<span onclick="deleteData();" class="btn btn-danger">' +
 		                        '<i class="fa fa-trash-o" style="margin-right:3px;"></i><@spring.message "hap.delete"/></span>'
 		                    },
 		                    {
 		                        name: "cancel",
 		                        template: '<span class="btn btn-default k-grid-cancel-changes">' +
 		                        '<i class="fa fa-eraser" style="margin-right:3px;"></i><@spring.message "hap.cancel"/></span>'
 		                    }/* ,
 		                    {
 		                    	template: '<span id="importExcelBtn1" style="float:left;margin-right:5px;" class="btn btn-primary" onclick="importExcel1()">'+
 		                			'<i class="fa fa-file-excel-o" style="margin-right:3px;"></i>渠道供应商信息导入</span>',
 		                    } */
 		                ],
 				columns : [
 					{
 						field : "id",
 						title : 'id',
 						width : 100,
 						hidden:true
 		            },
 					{
 						field : "channelCode",
 						title : "渠道编号<span style='color:red'>*</span>",
 						width : 100,
 						headerAttributes: {
 		                    style: "text-align:center"
 		               	},
 		               	attributes: {
 		                    style: "text-align:center"
 		               	},
 		               	/* editor: function (container, options) {
 		                    $('<input class="k-textbox" disabled  style="background: #EBEBEB;" name="' + options.field + '"/>')
 		                        .appendTo(container);
 		                } */
 		                editor: function (container, options) {
 		                    $('<input required data-required-msg="必输" name="' + options.field + '"/>')
 		                            .appendTo(container)
 		                            .kendoLov($.extend(<@lov "CMN_CHANNEL"/>,
 		                           {
 		                                textField: 'channelCode',
 		                                valueField: 'channelCode',
 		                                model    : options.model,
 		                                select:function(e){
 						                	options.model.set('channelId', e.item.channelId);
 						                	options.model.set('channelName', e.item.channelName);
 						                	options.model.set('channelCode', e.item.channelCode);
 						                }
 		                            },
 		                            {
 		                            	query: function (e) {
 		                                   /* e.param['supplierId'] = options.model.supplierId;
 		                                   e.param['channelClassCode'] = options.model.channelClassCode; */
 		                                 }
 		                            }));
 		                }
 		            },
 					{
 						field : "channelName",
 						title : "渠道名称<span style='color:red'>*</span>",
 						width : 120,
 						headerAttributes: {
 		                    style: "text-align:center"
 		               	},
 		               	attributes: {
 		                    style: "text-align:center"
 		               	},
 		               /* 	editor: function (container, options) {
 		                    $('<input required data-required-msg="必输" name="' + options.field + '"/>')
 		                            .appendTo(container)
 		                            .kendoLov($.extend(<@lov "CMN_CHANNEL"/>,
 		                           {
 		                                textField: 'channelName',
 		                                model    : options.model,
 		                                select:function(e){
 						                	options.model.set('channelId', e.item.channelId);
 						                	options.model.set('channelName', e.item.channelName);
 						                	options.model.set('channelCode', e.item.channelCode);
 						                }
 		                            },
 		                            {
 		                            	query: function (e) {
 		                                   //e.param['supplierId'] = options.model.supplierId;
 		                                   //e.param['channelClassCode'] = options.model.channelClassCode;
 		                                 }
 		                            }));
 		                } */
 		                editor: function (container, options) {
 		                    $('<input class="k-textbox" disabled  style="background: #EBEBEB;" name="' + options.field + '"/>')
 		                        .appendTo(container);
 		                }
 					},
 					/* {
 					field : "supplierCode",
 					title : "供应商编号<span style='color:red'>*</span>",
 					width : 100,
 					headerAttributes: {
 	                    style: "text-align:center"
 	               	},
 	               	attributes: {
 	                    style: "text-align:center"
 				   },
 				   editor : function(container, options){
 		            	$('<input required data-required-msg="必输" name="' + options.field + '"/>').appendTo(container).kendoLov($.extend(${lovProvider.getLov(base.contextPath, base.locale, "SPE_SUPPLIER_NAME")},
 	                   	{
 	                   	model: options.model,
 	                   	textField: 'supplierCode',
 	                   	select : function(e){
 	                   		options.model.set('supplierCode', e.item.supplierCode);
 	                   		options.model.set('name', e.item.name);
 	                   		options.model.set('supplierId', e.item.supplierId);
 	                   	}
 	                   }))
 		            },
 				},  */
 				{
 					field : "name",
 					title : "供应商名称<span style='color:red'>*</span>",
 					width : 120,
 					headerAttributes: {
 	                    style: "text-align:center"
 	               	},
 	               	attributes: {
 	                    style: "overflow:hidden;white-space:nowrap;text-overflow:ellipsis;text-align:center"
 	               	},
 	               	editor : function(container, options){
 		            	$('<input required data-required-msg="必输" name="' + options.field + '"/>').appendTo(container).kendoLov($.extend(${lovProvider.getLov(base.contextPath, base.locale, "SPE_SUPPLIER_NAME")},
 	                   	{
 	                   	model: options.model,
 	                   	textField: 'name',
 	                   	select : function(e){
 	                   		// options.model.set('supplierCode', e.item.supplierCode);
 	                   		options.model.set('name', e.item.name);
 	                   		options.model.set('supplierId', e.item.supplierId);
 	                   	}
 	                   }))
 		            },
 		        },
 		        {
 	                field: "bigClass",
 	                title: "产品大分类<span style='color:red'>*</span>",
 	                width: 100,
 	                headerAttributes: {
 	                    'class':'table-header-cell',
 	                    style:'text-align: center'
 	                },
 	                template: function(dataItem){
 	                    var v = dataItem.bigClass||'';
 	                    $.each(prdItemsDivision,function(i,n){
 	                        if((n.value||'').toLowerCase() == (v||'').toLowerCase()){
 	                            v = n.meaning;
 	                            return v;
 	                        }
 	                    })
 	                    return v;
 	                },
 	                editor: function(container, options){
 	                    $('<input required data-required-msg="必输" name="' + options.field + '"/>')
 	                            .appendTo(container)
 	                            .kendoDropDownList({
 	                                dataTextField: "meaning",
 	                                dataValueField: "value",
 	                                dataSource: prdItemsDivision,
 	                                change : function(e) {
 	                                    if (e.sender._prev=="") {
 	                                        //当lov中数据清除时，绑定的值也清空
 	                                        options.model.set('midClass', '');
 	                                        options.model.set('minClass', '');
 	                                    }
 	                                    options.model.set('productId', null);
 	                                    options.model.set('itemName', '');
 	                                    options.model.set('itemId', '');
 	                                    options.model.set('itemCode', '');
 	                                    options.model.set('contributionPeriod', '');
 	                            		options.model.set('productId','');
 	                                }
 	                            });
 	                }
 	            },
 	            {
 	                field: "midClass",
 	                title: '产品中分类',
 	                width: 100,
 	                headerAttributes: {
 	                    'class':'table-header-cell',
 	                    style:'text-align: center'
 	                },
 	                template: function(dataItem){
 	                    var v = dataItem.midClass||'';
 	                    $.each(prdItemsClass,function(i,n){
 	                        if((n.value||'').toLowerCase() == (v||'').toLowerCase()){
 	                            v = n.meaning;
 	                            return v;
 	                        }
 	                    })
 	                    return v;
 	                },
 	                editor: function (container, options) {
 	                    var params = {'params':{'className1':options.model.bigClass}};
 	                    //产品中分类
 	                    $.ajax({
 	                        type:"POST",
 	                        async:false,
 	                        url:"${base.contextPath}/clb/common/lov/PRD_CLASS",
 	                        data:{"statusCode":"Y","className1":options.model.bigClass},
 	                        success: function(e) {
 	                            $('<input name="' + options.field + '" data-bind="value:midClass" />')
 	                                .appendTo(container)
 	                                .kendoDropDownList({
 	                                    dataTextField: "meaning",
 	                                    dataValueField: "value",
 	                                    dataSource: e.rows,
 	                                    optionLabel:"--请选择--",
 	                                    change : function(e) {
 	                                        if (e.sender._prev=="") {
 	                                            //当lov中数据清除时，绑定的值也清空
 	                                            options.model.set('minClass', '');
 	                                        }
 	                                        options.model.set('productId', null);
 	                                        options.model.set('itemName', '');
 	                                        options.model.set('itemId', '');
 	                                        options.model.set('itemCode', '');
 	                                        options.model.set('contributionPeriod', '');
 	                                		options.model.set('productId','');
 	                                    }
 	                                });
 	                        }
 	                    });
 	                }
 	            },
 	            {
 	                field: "minClass",
 	                title: '产品小分类',
 	                width: 100,
 	                headerAttributes: {
 	                    'class':'table-header-cell',
 	                    style:'text-align: center'
 	                },
 	                template: function(dataItem){
 	                    var v = dataItem.minClass||'';
 	                    $.each(prdItemsCatagory,function(i,n){
 	                        if((n.value||'').toLowerCase() == (v||'').toLowerCase()){
 	                            v = n.meaning;
 	                            return v;
 	                        }
 	                    })
 	                    return v;
 	                },
 	                editor: function (container,  options) {
 	                    var params = {'params':{'className1':options.model.bigClass,'className2':options.model.midClass}};
 	                    //产品小分类
 	                    $.ajax({
 	                        type:"POST",
 	                        async:false,
 	                        url:"${base.contextPath}/clb/common/lov/PRD_CATAGORY",
 	                        data:{"statusCode":"Y","className1":options.model.bigClass,"className2":options.model.midClass},
 	                        success: function(e) {
 	                            $('<input name="' + options.field + '" data-bind="value:minClass" />')
 	                                    .appendTo(container)
 	                                    .kendoDropDownList({
 	                                        dataTextField: "meaning",
 	                                        dataValueField: "value",
 	                                        dataSource: e.rows,
 	                                        optionLabel:"--请选择--",
 	                                        change : function(e) {
 	                                        	options.model.set('productId', null);
 	                                            options.model.set('itemName', '');
 	                                            options.model.set('itemId', '');
 	                                            options.model.set('itemCode', '');
 	                                            options.model.set('contributionPeriod', '');
 	                                    		options.model.set('productId','');
 	                                        }
 	                                    });
 	                        }
 	                    });
 	                }
 	            },
 	            {
 					field : "prdSupplierId",
 					title : '产品公司',
 					width : 120,
 					headerAttributes: {
 	                    style: "text-align:center"
 	               	},
 	               	attributes: {
 	                    style: "text-align:center"
 	               	},
 	               	template: function(dataItem){
 	                    var v = dataItem.prdSupplierName||'';
 	                    return v;
 	                },
 	               	editor : function(container, options){
 	               		$('<input name="' + options.field + '"/>').appendTo(container).kendoLov($.extend(${lovProvider.getLov(base.contextPath, base.locale, "PRD_SUPPLIER_NAME_CHANNEL")},
 	                    	{
 	                    	model: options.model,
 	                    	textField: 'prdSupplierName',
 	                    	select : function(e){
 	                            options.model.set('prdSupplierId', e.item.prdSupplierId);
 	                            options.model.set('prdSupplierName', e.item.name);
 	                    		options.model.set('productId', null);
 	                            options.model.set('itemName', '');
 	                            options.model.set('itemId', '');
 	                            options.model.set('itemCode', '');
 	                            options.model.set('contributionPeriod', '');
 	                    	},
 	                    	change:function (e){
 	                      	  if (e.sender._prev=="") {
 	                          		options.model.set('productId', null);
 				                	options.model.set('itemCode', null);
 				                	options.model.set('itemName', null);
 				                	options.model.set('contributionPeriod', null);
 	                      	  }
 	                       }
 	                    }))
 		            },
 				},
 				/* {
 					field : "itemCode",
 					title : '产品编号',
 					width : 100,
 					headerAttributes: {
 	                    style: "text-align:center"
 	               	},
 	               	attributes: {
 	                    style: "text-align:center"
 	               	},
 	               	editor : function(container, options){
 		            	$('<input  name="' + options.field + '"/>').appendTo(container).kendoLov($.extend(${lovProvider.getLov(base.contextPath, base.locale, "PRD_ITEMS")},
 	                    	{
 	                    	model: options.model,
 	                    	textField: 'itemCode',
 	                    	query: function (e) {
 	                            e.param['bigClass'] = options.model.bigClass;
 	                            e.param['midClass'] = options.model.midClass;
 	                            e.param['minClass'] = options.model.minClass;
 	                            e.param['supplierId'] = options.model.prdSupplierId;
 	                        },
 	                    	select : function(e){
 	                    		options.model.set('itemCode', e.item.itemCode);
 	                    		options.model.set('itemName', e.item.itemName);
 	                    		options.model.set('productId', e.item.itemId);
 	                    		options.model.set('bigClass', e.item.bigClass);
 	                            options.model.set('midClass', e.item.midClass);
 	                            options.model.set('minClass', e.item.minClass);
 	                            options.model.set('prdSupplierId', e.item.supplierId);
 	                            options.model.set('prdSupplierName', e.item.supplierName);
 	                    	}
 	                    }))
 		            },
 				},  */
 				{
 					field : "itemName",
 					title : '产品名称',
 					width : 120,
 					headerAttributes: {
 	                    style: "text-align:center"
 	               	},
 	               	attributes: {
 	                    style: "text-align:center"
 	               	},
 	            	editor : function(container, options){
 		            	$('<input  name="' + options.field + '"/>').appendTo(container).kendoLov($.extend(${lovProvider.getLov(base.contextPath, base.locale, "PRD_ITEMS")},
 	                    	{
 	                    	model: options.model,
 	                    	textField: 'itemName',
 	                    	query: function (e) {
 	                            e.param['bigClass'] = options.model.bigClass;
 	                            e.param['midClass'] = options.model.midClass;
 	                            e.param['minClass'] = options.model.minClass;
 	                            e.param['supplierId'] = options.model.prdSupplierId;
 	                        },
 	                    	select : function(e){
 	                    		options.model.set('itemCode', e.item.itemCode);
 	                    		options.model.set('itemName', e.item.itemName);
 	                    		options.model.set('productId', e.item.itemId);
 	                    		options.model.set('bigClass', e.item.bigClass);
 	                            options.model.set('midClass', e.item.midClass);
 	                            options.model.set('minClass', e.item.minClass);
 	                            options.model.set('prdSupplierId', e.item.supplierId);
 	                            options.model.set('prdSupplierName', e.item.supplierName);
 	                    	},
 	                    	change : function(e){
 	                    		if (e.sender._prev == '' || e.sender._prev == null) {
 	                                options.model.set('itemName', null);
 	                                options.model.set('itemId', null);
 	                                options.model.set('itemCode', null);
 	                                options.model.set('productId', null);
 	                            }
 							}
 	                    }))
 		            },
 				},
 				{
 					field : "contributionPeriod",
 					title : '供款期1',
 					width : 80,
 					headerAttributes: {
 	                    style: "text-align:center"
 	               	},
 	               	attributes: {
 	                    style: "text-align:center"
 	               	},
 	               	editor: function (container, options) {
 	                    $('<input  name="' + options.field + '"/>')
 	                            .appendTo(container)
 	                            .kendoLov($.extend(<@lov "ORD_SUBLINE"/>,
 	                           {
 	                                model    : options.model,
 	                                select:function(e){
 					                	options.model.set('contributionPeriod', e.item.sublineItemName);
 					                }
 	                            },
 	                            {
 	                            	query: function (e) {
 	                                   e.param['itemId'] = options.model.productId;
 	                                 }
 	                            }));
 	                }
 				},
 				          ]

 			}).data("kendoGrid");


		 	function deleteData(){
		 		var grid = $("#grid").data("kendoGrid");
		 	    var checked = grid.selectedDataItems();
		 	    if(grid.selectedDataItems().length){
		 	        kendo.ui.showConfirmDialog({
		 	            title:$l('hap.tip.info'),
		 	            message: $l('hap.tip.delete_confirm')
		 	        }).done(function (event) {
		 	            if (event.button == 'OK') {
		 	                $.each(checked,function(i,v){
		 	                    grid.dataSource.remove(v)
		 	                })
		 	                grid.dataSource.sync();
		 	            }
		 	        })
		 	    }
		 	}

		 	function save(){
		 		$('#grid').data('kendoGrid').saveChanges();
		 	}




 	 Hap.autoResizeGrid("#Grid");
    </script>
</body>
