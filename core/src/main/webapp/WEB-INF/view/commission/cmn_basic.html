<#--
        * description: Basic佣金表设置
        * version: 1.0
        * author: zixi.xie@hand-china.com
        * -->
<#include "../include/header.html">
<style>
    label.col-sm-3.control-label {
        text-align: right;
        padding-top: 7px;
    }
    #query-form .row{
        margin-bottom: 10px;
    }
</style>
<script src="${base.contextPath}/clb/common/clbCode?currency=PUB.CURRENCY&payMethod=CMN.PAY_METHOD&priceType=CMN.PRICE_TYPE"></script>
<script type="text/javascript">
    var viewModel = kendo.observable({
        model: {
        },
        //查询
        queryResource: function (e) {
            grid.dataSource.page(1);
        },
        //重置
        resetForm:function (e) {
            var formData = viewModel.model.toJSON();
            for (var k in formData) {
                viewModel.model.set(k, null);
            }
        },
        //新建
        createFunction: function () {
            //只能新建一条数据
            if($("#Grid").find(".k-grid-edit-row").length==1){
                kendo.ui.showInfoDialog({
                    message:"请先保存"
                });
            }else {
                grid.addRow();
            }
        },
        //保存
        saveFunction: function () {
            grid._validationEditCell();
            console.log(grid._data[0]);
            if ((grid.editable && grid.editable.end() || !grid.editable)&&$("#Grid").find(".k-grid-edit-row").length==1) {
                /*if(grid._data[0].policyholdersMinAge>=grid._data[0].policyholdersMaxAge){
                    kendo.ui.showErrorDialog({
                        message:"年龄范围不合法"
                    })
                }else */if(grid._data[0].priceType=="PERCENTAGE"&&
                        (grid._data[0].theFirstYear>10||grid._data[0].theSecondYear>10||
                        grid._data[0].theSecondYear>10||grid._data[0].theSecondYear>10||
                        grid._data[0].theSecondYear>10||grid._data[0].theSecondYear>10||
                        grid._data[0].theSecondYear>10||grid._data[0].theSecondYear>10||
                        grid._data[0].theSecondYear>10||grid._data[0].theSecondYear>10)){
                    kendo.ui.showErrorDialog({
                        message:"价格类型为百分比时,第一年至第十年范围为0~1000(%)"
                    })
                }
                else {
                    var maxVersion = 0;
                    $.ajax({
                        url:"${base.contextPath}/fms/cmn/basic/queryMaxVersion",
                        method:"POST",
                        contentType:"application/json",
                        dataType:"json",
                        data:JSON.stringify(grid._data[0]),
                        success:function (data) {
                            maxVersion = data;
                            if(maxVersion>=1){
                                kendo.ui.showConfirmDialog({
                                    title: '提示',
                                    message:"存在旧版本数据,是否生成新版本?"
                                }).done(function(event) {
                                    if (event.button == 'OK') {
                                        $.ajax({
                                            url:"${base.contextPath}/fms/cmn/basic/addVersion/"+maxVersion,
                                            method:"POST",
                                            contentType:"application/json",
                                            dataType:"json",
                                            data:JSON.stringify(grid._data[0]),
                                            success:function (data) {
                                                if(data.success){
                                                    kendo.ui.showInfoDialog({
                                                        message:"成功"
                                                    }).done(function () {
                                                        $(".k-i-refresh").trigger("click");
                                                    });
                                                }else {
                                                    kendo.ui.showInfoDialog({
                                                        message:"失败"
                                                    });
                                                }
                                            }
                                        });
                                    }
                                })
                            }else {
                                grid.saveChanges();
                                grid.dataSource.page(1);
                            }
                        }
                    });
                }
            }
        },
        //取消
        cancelFunction:function (e) {
            grid.cancelChanges();
        }
    });
    /*$.ajax({
    	url:"${base.contextPath}/clb/sys/user/isAdmin",
    	method:"POST",
        contentType:"application/json",
        dataType:"json",
        data:{},
        success:function (data) {
        	if(data){
        		$("#toolbar-btn").show();
        	}else{
        		$("#toolbar-btn").hide();
        	}
        }
    });*/
</script>
<body>
<div id="page-content">
    <!--查询面板-->
    <div class="panel">
        <div id="query-form">
            <div class="panel-body">
                <div class="row">
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="productCompany" class="col-sm-3 control-label"><@spring.message "CmnBasic.productCompany"/></label>
                            <div class="col-sm-9">
                                <input id="productCompany" style="width:100%" >
                            </div>
                        </div>
                    </div>
                    <!-- <div class="col-sm-4">
                        <div class="form-group">
                            <label for="itemCode" class="col-sm-3 control-label"><@spring.message "CmnBasic.itemCode"/></label>
                            <div class="col-sm-9">
                                <input id="itemCode" style="width:100%"
                                       data-bind="value:model.itemCode">
                            </div>
                        </div>
                    </div> -->
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="itemName" class="col-sm-3 control-label"><@spring.message "CmnBasic.itemName"/></label>
                            <div class="col-sm-9">
                                <input id="itemName" style="width:100%"
                                       data-bind="value:model.itemName">
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="contributionPeriod" class="col-sm-3 control-label"><@spring.message "CmnBasic.contributionPeriod"/></label>
                            <div class="col-sm-9">
                                <input id="contributionPeriod" style="width:100%" class="k-textbox"
                                       data-bind="value:model.contributionPeriod">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="currency" class="col-sm-3 control-label"><@spring.message "CmnBasic.currency"/></label>
                            <div class="col-sm-9">
                                <input id="currency" style="width:100%"
                                       data-bind="value:model.currency">
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="payMethod" class="col-sm-3 control-label"><@spring.message "CmnBasic.payMethod"/></label>
                            <div class="col-sm-9">
                                <input id="payMethod" style="width:100%"
                                       data-bind="value:model.payMethod">
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="version" class="col-sm-3 control-label"><@spring.message "CmnBasic.version"/></label>
                            <div class="col-sm-9">
                                <input id="version" style="width:100%" class="k-textbox"
                                       data-bind="value:model.version">
                            </div>
                        </div>
                    </div>
                </div>

               <!--  <div class="row">
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="policyHoldersAge" class="col-sm-3 control-label"><@spring.message "CmnBasic.policyHoldersAge"/></label>
                            <div class="col-sm-9">
                                <input id="policyHoldersAge" style="width:100%" class="k-textbox"
                                       data-bind="value:model.policyHoldersAge">
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="version" class="col-sm-3 control-label"><@spring.message "CmnBasic.version"/></label>
                            <div class="col-sm-9">
                                <input id="version" style="width:100%" class="k-textbox"
                                       data-bind="value:model.version">
                            </div>
                        </div>
                    </div>
                </div> -->
            </div>
        </div>
        <div class="panel-footer text-right">
        	<span class="btn btn-primary" style="display: none;" onclick="importData();" id="importData" >
                        <i class="fa fa-search"
                           style="margin-right:3px;"></i><@spring.message "clb.importinitialdata"/></span>
            <span class="btn btn-primary" style="width:70px" data-bind="click:queryResource">
                <i class="fa fa-search" style="margin-right:3px;"></i><@spring.message "hap.query"/>
            </span>
            <span class="btn btn-default" style="width:70px" data-bind="click:resetForm">
                <i class="fa fa-refresh" style="margin-right:3px;"></i><@spring.message "hap.reset"/>
            </span>
        </div>
    </div>

    <div class="pull-left" id="toolbar-btn" style="margin-bottom:10px">
        <span style="float:left;margin-right:5px;" class="btn btn-primary" data-bind="click:createFunction">
          <i class="fa fa-plus-square" style="margin-right:3px;"></i><@spring.message "hap.new"/>
        </span>
        <span style="float:left;margin-right:5px;" class="btn btn-success" data-bind="click:saveFunction">
            <i class="fa fa-save" style="margin-right:3px;"></i><@spring.message "hap.save"/>
        </span>
        <span style="float:left;margin-right:5px;" class="btn btn-default" data-bind="click:cancelFunction">
            <i class="fa fa-reply" style="margin-right:3px;"></i><@spring.message "hap.cancel"/>
        </span>
    </div>
    <div style="clear:both">
        <div id="Grid"></div>
    </div>
</div>
<div id="excelWindow" style="clear: both"></div>
<script type="text/javascript">
	$.ajax({
		url:"${base.contextPath}/clb/sys/user/isImporter",
		method:"POST",
	    contentType:"application/json",
	    dataType:"json",
	    data:{},
	    success:function (data) {
	    	if(data){
	    		$("#importData").show();
	    	}else{
	    		$("#importData").hide();
	    	}
	    }
	});
	//　导入期初数据
    function importData(){
        var url = '${base.contextPath}/fnd/import/import_upload.html?className=clb.core.commission.service.impl.CmnBasicImport';
        var importDialog = $("#excelWindow").kendoWindow({
            actions: ["Close"],
            width: '100%',
            height: '100%',
            title: '<@spring.message "clb.importinitialdata"/>',
            content: url,
            iframe: true,
            visible: false,
            modal: true,
            close: function () {
                //window 关闭  刷新本页面的grid
                $('#Grid').data('kendoGrid').dataSource.page(1);
            }
        }).data("kendoWindow");
        importDialog.maximize();
        importDialog.center().open();
    }
	
    var BaseUrl = _basePath;

    kendo.bind($('#page-content'), viewModel);

    $('#productCompany').kendoLov({
        code: "CMN_PRODUCT_COMPANY",
        contextPath: '${base.contextPath}',
        locale: '${base.locale}',
        select: function (e) {
            viewModel.model.set('supplierId',e.item.supplierId);
            viewModel.model.set('itemCode',null);
            viewModel.model.set('itemName',null);
        },
        change:function(e){
            if(e.sender._prev == '' || e.sender._prev == null){
            	viewModel.model.set('supplierId',null);
                viewModel.model.set('itemCode',null);
                viewModel.model.set('itemName',null);
            }
        }
    });

    $('#itemName').kendoLov({
        code: "PRD_ITEM",
        contextPath: '${base.contextPath}',
        locale: '${base.locale}',
        query:function (e) {
            if(viewModel.model.supplierId != null){
                e.param['supplierId'] = viewModel.model.supplierId;
            }
        },
        select: function (e) {
            viewModel.model.set('itemName',e.item.itemName);
        },
        change:function(e){
            if(e.sender._prev == '' || e.sender._prev == null){
                viewModel.model.set('itemCode',null);
                viewModel.model.set('itemName',null);
            }
        }
    });

    $('#currency').kendoDropDownList({
        optionLabel: "-请选择币种-",
        filter: "contains",
        valuePrimitive: true,
        dataTextField : "meaning",
        dataValueField : "value",
        dataSource:currency
    });

    $('#payMethod').kendoDropDownList({
        optionLabel: "-请选择繳款方式-",
        filter: "contains",
        valuePrimitive: true,
        dataTextField : "meaning",
        dataValueField : "value",
        dataSource:payMethod
    });

    dataSource = new kendo.data.DataSource({
        transport: {
            read: {
                url: BaseUrl + "/fms/cmn/basic/queryBasic",
                type: "POST",
                dataType: "json"
            },
            create: {
                url: BaseUrl + "/fms/cmn/basic/submit",
                type: "POST",
                contentType: "application/json"
            },
            parameterMap: function (options, type) {
                if (type !== "read" && options.models) {
                    var datas = Hap.prepareSubmitParameter(options, type);
                    return kendo.stringify(datas);
                } else if (type === "read") {
                    return Hap.prepareQueryParameter(viewModel.model.toJSON(), options)
                }
            }
        },
        batch: true,
        serverPaging: true,
        pageSize: 10,
        schema: {
            data: 'rows',
            total: 'total',
            model: {
                id: "basicId",
                fields: {
                    policyholdersMinAge:{type: "number",defaultValue:0},
                    policyholdersMaxAge:{type: "number",defaultValue:100},
                    theFirstYear:{type: "number",defaultValue:0},
                    theSecondYear:{type: "number",defaultValue:0},
                    theThirdYear:{type: "number",defaultValue:0},
                    theFourthYear:{type: "number",defaultValue:0},
                    theFifthYear:{type: "number",defaultValue:0},
                    theSixthYear:{type: "number",defaultValue:0},
                    theSeventhYear:{type: "number",defaultValue:0},
                    theEightYear:{type: "number",defaultValue:0},
                    theNinthYear:{type: "number",defaultValue:0},
                    theTenthYear:{type: "number",defaultValue:0},
                    version:{type: "number",defaultValue:1},
                    effectiveStartDate:{type: "date",defaultValue:new Date()},
                    effectiveEndDate:{type: "date",defaultValue:'2099-12-31'}
                },
                editable:function (col) {
                    return !(this.basicId != "" || col == "version");
                }
            }
        }
    });

    var grid = $("#Grid").kendoGrid({
        dataSource: dataSource,
        height: '100%',
        resizable: true,
        scrollable: true,
        rownumber: true,
        navigatable: false,
        pageable: {
            pageSizes: [5, 10, 20, 50],
            refresh: true,
            buttonCount: 5
        },
        columns: [
            //产品公司
            {
                field: "supplierId",
                title: '<@spring.message "CmnBasic.productCompany"/>',
                width: 120,
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                },
                template: function (dataItem) {
                    return dataItem.productCompany;
                },
                editor: function (container, options) {
                    $('<input required data-required-msg="必输"  name="' + options.field + '"/>')
                        .appendTo(container).kendoLov({
                        code: "CMN_PRODUCT_COMPANY",
                        contextPath: '${base.contextPath}',
                        locale: '${base.locale}',
                        model: options.model,
                        textField: 'productCompany',
                        select: function (e) {
                            options.model.set('supplierId',e.item.supplierId);
                            options.model.set('productCompany',e.item.name);
                            options.model.set('itemCode',null);
                            options.model.set('itemName',null);
                        },
                        change:function(e){
                            if(e.sender._prev == '' || e.sender._prev == null){
                                options.model.set('itemCode',null);
                                options.model.set('itemName',null);
                            }
                        }
                    });
                }
            },
            //产品编号
            {
                field: "itemCode",
                title: '<@spring.message "CmnBasic.itemCode"/>',
                width: 120,
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                },
                editor: function (container, options) {
                    $('<input required data-required-msg="必输" name="' + options.field + '"/>')
                        .appendTo(container).kendoLov({
                        code: "CMN_PRODUCT",
                        contextPath: '${base.contextPath}',
                        locale: '${base.locale}',
                        model: options.model,
                        textField: 'itemCode',
                        query:function (e) {
                            if(options.model.supplierId != null){
                                e.param['supplierId'] = options.model.supplierId;
                            }
                        },
                        select: function (e) {
                        	options.model.set('setItemId',e.item.itemId);
                            options.model.set('itemId',e.item.itemId);
                            options.model.set('itemCode',e.item.itemCode);
                            options.model.set('itemName',e.item.itemName);
                        },
                        change:function(e){
                            if(e.sender._prev == '' || e.sender._prev == null){
                            	options.model.set('setItemId',-9999);
                            	options.model.set('itemCode',null);
                                options.model.set('itemName',null);
                            }
                            changePrd(options);
                        }
                    });
                }
            },
            //产品名称
            {
                field: "itemName",
                title: '<@spring.message "CmnBasic.itemName"/>',
                width: 120,
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                },
                editor: function (container, options) {
                    $('<input class="k-textbox" readonly style="background: #EBEBEB;" name="' + options.field + '"/>')
                        .appendTo(container);
                }

            },
            //供款期
            {
                field: "contributionPeriod",
                title: '<@spring.message "CmnBasic.contributionPeriod"/>',
                width: 120,
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                },
                editor: function (container, options) {
                	$('<input  required data-required-msg="必输" name="' + options.field + '"/>').appendTo(container)
                    .kendoLov($.extend(<@lov "CMN_SUBLINE"/>, 
                   {
                        textField: 'sublineItemName',
                        model    : options.model,
                        select:function(e){
		                }
                    },
                    {
                    	query: function (e) {
                           e.param['itemId'] = options.model.itemId;
                         }
                    })); 
                	if(options.model.itemId){
                    	$("input[name='contributionPeriod']").data("kendoLov").enable(true);
                	}else{
                		$("input[name='contributionPeriod']").data("kendoLov").enable(false);
                	}
                }
            },
            //币种
            {
                field: "currency",
                title: '<@spring.message "CmnBasic.currency"/>',
                width: 120,
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                },
                template: function (dataItem) {
                    for (var i in currency) {
                        if (dataItem.currency == currency[i].value) {
                            return currency[i].meaning;
                        }
                    }
                    return "";
                },
                editor: function (container, options) {
                    $('<input required data-required-msg="必输" name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoDropDownList({
                            optionLabel: "-请选择币种-",
                            filter: "contains",
                            dataTextField: "meaning",
                            dataValueField: "value",
                            valuePrimitive: true,
                            dataSource: currency
                        });
                    if(options.model.itemId){
                    	$("input[name='currency']").data("kendoDropDownList").enable(true);
                	}else{
                		$("input[name='currency']").data("kendoDropDownList").enable(false);
                	}
                }
            },
            //缴款方式
            {
                field: "payMethod",
                title: '<@spring.message "CmnBasic.payMethod"/>',
                width: 120,
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                },
                template: function (dataItem) {
                    for (var i in payMethod) {
                        if (dataItem.payMethod == payMethod[i].value) {
                            return payMethod[i].meaning;
                        }
                    }
                    return "";
                },
                editor: function (container, options) {
                    $('<input required data-required-msg="必输" name="' + options.field + '" data-bind="value:payMethod" />')
                        .appendTo(container)
                        .kendoDropDownList({
                            optionLabel: "-请选择缴款方式-",
                            filter: "contains",
                            dataTextField: "meaning",
                            dataValueField: "value",
                            valuePrimitive: true,
                            dataSource: payMethod
                        }); 
                    if(options.model.itemId){
                    	$("input[name='payMethod']").data("kendoDropDownList").enable(true);
                	}else{
                		$("input[name='payMethod']").data("kendoDropDownList").enable(false);
                	}
                }
            },
            //受保人年龄起
            {
                field: "policyholdersMinAge",
                title: '<@spring.message "CmnBasic.policyholdersMinAge"/>',
                width: 120,
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                },
                editor: function (container, options) {
                    $('<input required data-required-msg="必输" name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoNumericTextBox({
                            format: "#. ",
                            min: 0,
                            max: 100,
                            step: 1
                        });
                }
            },
            //受保人年龄至
            {
                field: "policyholdersMaxAge",
                title: '<@spring.message "CmnBasic.policyholdersMaxAge"/>',
                width: 120,
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                },
                editor: function (container, options) {
                    $('<input required data-required-msg="必输" name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoNumericTextBox({
                            format: "#. ",
                            min: 1,
                            max: 100,
                            step: 1
                        });
                }
            },
            //价格类型
            {
                field: "priceType",
                title: '<@spring.message "CmnBasic.priceType"/>',
                width: 120,
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                },
                template: function (dataItem) {
                    for (var i in priceType) {
                        if (dataItem.priceType == priceType[i].value) {
                            return priceType[i].meaning;
                        }
                    }
                    return "";
                },

                editor: function (container, options) {
                    $('<input required data-required-msg="必输" name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoDropDownList({
                            filter: "contains",
                            optionLabel: "-请选择价格类型-",
                            dataTextField: "meaning",
                            dataValueField: "value",
                            valuePrimitive: true,
                            dataSource: priceType,
                            select:function (e) {
                                if(e.dataItem.value=="PERCENTAGE"){
                                    //重置组件
                                    $("input[name=theFirstYear]").data("kendoNumericTextBox").value(0);
                                    $("input[name=theFirstYear]").data("kendoNumericTextBox").destroy();
                                    $("input[name=theFirstYear]").kendoNumericTextBox({
                                        format: "p2",
                                        decimals: 4,
                                        min: 0,
                                        max:10,
                                        step: 0.01
                                    });
                                    $("input[name=theSecondYear]").data("kendoNumericTextBox").value(0);
                                    $("input[name=theSecondYear]").data("kendoNumericTextBox").destroy();
                                    $("input[name=theSecondYear]").kendoNumericTextBox({
                                        format: "p2",
                                        decimals: 4,
                                        min: 0,
                                        max:10,
                                        step: 0.01
                                    });
                                    $("input[name=theThirdYear]").data("kendoNumericTextBox").value(0);
                                    $("input[name=theThirdYear]").data("kendoNumericTextBox").destroy();
                                    $("input[name=theThirdYear]").kendoNumericTextBox({
                                        format: "p2",
                                        decimals: 4,
                                        min: 0,
                                        max:10,
                                        step: 0.01
                                    });
                                    $("input[name=theFourthYear]").data("kendoNumericTextBox").value(0);
                                    $("input[name=theFourthYear]").data("kendoNumericTextBox").destroy();
                                    $("input[name=theFourthYear]").kendoNumericTextBox({
                                        format: "p2",
                                        decimals: 4,
                                        min: 0,
                                        max:10,
                                        step: 0.01
                                    });
                                    $("input[name=theFifthYear]").data("kendoNumericTextBox").value(0);
                                    $("input[name=theFifthYear]").data("kendoNumericTextBox").destroy();
                                    $("input[name=theFifthYear]").kendoNumericTextBox({
                                        format: "p2",
                                        decimals: 4,
                                        min: 0,
                                        max:10,
                                        step: 0.01
                                    });
                                    $("input[name=theSixthYear]").data("kendoNumericTextBox").value(0);
                                    $("input[name=theSixthYear]").data("kendoNumericTextBox").destroy();
                                    $("input[name=theSixthYear]").kendoNumericTextBox({
                                        format: "p2",
                                        decimals: 4,
                                        min: 0,
                                        max:10,
                                        step: 0.01
                                    });
                                    $("input[name=theSeventhYear]").data("kendoNumericTextBox").value(0);
                                    $("input[name=theSeventhYear]").data("kendoNumericTextBox").destroy();
                                    $("input[name=theSeventhYear]").kendoNumericTextBox({
                                        format: "p2",
                                        decimals: 4,
                                        min: 0,
                                        max:10,
                                        step: 0.01
                                    });
                                    $("input[name=theEightYear]").data("kendoNumericTextBox").value(0);
                                    $("input[name=theEightYear]").data("kendoNumericTextBox").destroy();
                                    $("input[name=theEightYear]").kendoNumericTextBox({
                                        format: "p2",
                                        decimals: 4,
                                        min: 0,
                                        max:10,
                                        step: 0.01
                                    });
                                    $("input[name=theNinthYear]").data("kendoNumericTextBox").value(0);
                                    $("input[name=theNinthYear]").data("kendoNumericTextBox").destroy();
                                    $("input[name=theNinthYear]").kendoNumericTextBox({
                                        format: "p2",
                                        decimals: 4,
                                        min: 0,
                                        max:10,
                                        step: 0.01
                                    });
                                    $("input[name=theTenthYear]").data("kendoNumericTextBox").value(0);
                                    $("input[name=theTenthYear]").data("kendoNumericTextBox").destroy();
                                    $("input[name=theTenthYear]").kendoNumericTextBox({
                                        format: "p2",
                                        decimals: 4,
                                        min: 0,
                                        max:10,
                                        step: 0.01
                                    });
                                }else if(e.dataItem.value=="NUMBER"){
                                    $("input[name=theFirstYear]").data("kendoNumericTextBox").value(0);
                                    $("input[name=theFirstYear]").data("kendoNumericTextBox").destroy();
                                    $("input[name=theFirstYear]").kendoNumericTextBox({
                                        min: 0,
                                        step: 0.01
                                    });
                                    $("input[name=theSecondYear]").data("kendoNumericTextBox").value(0);
                                    $("input[name=theSecondYear]").data("kendoNumericTextBox").destroy();
                                    $("input[name=theSecondYear]").kendoNumericTextBox({
                                        min: 0,
                                        step: 0.01
                                    });
                                    $("input[name=theThirdYear]").data("kendoNumericTextBox").value(0);
                                    $("input[name=theThirdYear]").data("kendoNumericTextBox").destroy();
                                    $("input[name=theThirdYear]").kendoNumericTextBox({
                                        min: 0,
                                        step: 0.01
                                    });
                                    $("input[name=theFourthYear]").data("kendoNumericTextBox").value(0);
                                    $("input[name=theFourthYear]").data("kendoNumericTextBox").destroy();
                                    $("input[name=theFourthYear]").kendoNumericTextBox({
                                        min: 0,
                                        step: 0.01
                                    });
                                    $("input[name=theFifthYear]").data("kendoNumericTextBox").value(0);
                                    $("input[name=theFifthYear]").data("kendoNumericTextBox").destroy();
                                    $("input[name=theFifthYear]").kendoNumericTextBox({
                                        min: 0,
                                        step: 0.01
                                    });
                                    $("input[name=theSixthYear]").data("kendoNumericTextBox").value(0);
                                    $("input[name=theSixthYear]").data("kendoNumericTextBox").destroy();
                                    $("input[name=theSixthYear]").kendoNumericTextBox({
                                        min: 0,
                                        step: 0.01
                                    });
                                    $("input[name=theSeventhYear]").data("kendoNumericTextBox").value(0);
                                    $("input[name=theSeventhYear]").data("kendoNumericTextBox").destroy();
                                    $("input[name=theSeventhYear]").kendoNumericTextBox({
                                        min: 0,
                                        step: 0.01
                                    });
                                    $("input[name=theEightYear]").data("kendoNumericTextBox").value(0);
                                    $("input[name=theEightYear]").data("kendoNumericTextBox").destroy();
                                    $("input[name=theEightYear]").kendoNumericTextBox({
                                        min: 0,
                                        step: 0.01
                                    });
                                    $("input[name=theNinthYear]").data("kendoNumericTextBox").value(0);
                                    $("input[name=theNinthYear]").data("kendoNumericTextBox").destroy();
                                    $("input[name=theNinthYear]").kendoNumericTextBox({
                                        min: 0,
                                        step: 0.01
                                    });
                                    $("input[name=theTenthYear]").data("kendoNumericTextBox").value(0);
                                    $("input[name=theTenthYear]").data("kendoNumericTextBox").destroy();
                                    $("input[name=theTenthYear]").kendoNumericTextBox({
                                        min: 0,
                                        step: 0.01
                                    });
                                }
                            }
                        });
                }
            },
            //第一年
            {
                field: "theFirstYear",
                title: '<@spring.message "CmnBasic.theFirstYear"/>',
                width: 120,
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                },
                template:function (dataItem) {
                    if(dataItem.priceType=="PERCENTAGE"){
                        return toFixed(dataItem.theFirstYear*100,2) + "%";
                    }else {
                        if(dataItem.theFirstYear){
                            return dataItem.theFirstYear;
                        }
                        return "0";
                    }
                },
                editor: function (container, options) {
                     $('<input required data-required-msg="必输" name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoNumericTextBox({
                            min: 0,
                            step: 0.01,
                        }).data("kendoNumericTextBox");
                }
            },
            //第二年
            {
                field: "theSecondYear",
                title: '<@spring.message "CmnBasic.theSecondYear"/>',
                width: 120,
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                },
                template:function (dataItem) {
                    if(dataItem.priceType=="PERCENTAGE"){
                        return toFixed(dataItem.theSecondYear*100,2) + "%";
                    }else {
                        if(dataItem.theSecondYear){
                            return dataItem.theSecondYear;
                        }
                        return "0";
                    }
                },
                editor: function (container, options) {
                    $('<input required data-required-msg="必输" name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoNumericTextBox({
                            min: 0,
                            step: 0.01
                        }).data("kendoNumericTextBox");
                }
            },
            //第三年
            {
                field: "theThirdYear",
                title: '<@spring.message "CmnBasic.theThirdYear"/>',
                width: 120,
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                },
                template:function (dataItem) {
                    if(dataItem.priceType=="PERCENTAGE"){
                        return toFixed(dataItem.theThirdYear*100,2) + "%";
                    }else {
                        if(dataItem.theThirdYear){
                            return dataItem.theThirdYear;
                        }
                        return "0";
                    }
                },
                editor: function (container, options) {
                    $('<input  required data-required-msg="必输" name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoNumericTextBox({
                            min: 0,
                            step: 0.01
                        }).data("kendoNumericTextBox");
                }
            },
            //第四年
            {
                field: "theFourthYear",
                title: '<@spring.message "CmnBasic.theFourthYear"/>',
                width: 120,
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                },
                template:function (dataItem) {
                    if(dataItem.priceType=="PERCENTAGE"){
                        return toFixed(dataItem.theFourthYear*100,2) + "%";
                    }else {
                        if(dataItem.theFourthYear){
                            return dataItem.theFourthYear;
                        }
                        return "0";
                    }
                },
                editor: function (container, options) {
                    $('<input  required data-required-msg="必输" name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoNumericTextBox({
                            min: 0,
                            step: 0.01
                        }).data("kendoNumericTextBox");
                }
            },
            //第五年
            {
                field: "theFifthYear",
                title: '<@spring.message "CmnBasic.theFifthYear"/>',
                width: 120,
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                },
                template:function (dataItem) {
                    if(dataItem.priceType=="PERCENTAGE"){
                        return toFixed(dataItem.theFifthYear*100,2) + "%";
                    }else {
                        if(dataItem.theFifthYear){
                            return dataItem.theFifthYear;
                        }
                        return "0";
                    }
                },
                editor: function (container, options) {
                    $('<input  required data-required-msg="必输" name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoNumericTextBox({
                            min: 0,
                            step: 0.01
                        }).data("kendoNumericTextBox");
                }
            },
            //第六年
            {
                field: "theSixthYear",
                title: '<@spring.message "CmnBasic.theSixthYear"/>',
                width: 120,
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                },
                template:function (dataItem) {
                    if(dataItem.priceType=="PERCENTAGE"){
                        return toFixed(dataItem.theSixthYear*100,2) + "%";
                    }else {
                        if(dataItem.theSixthYear){
                            return dataItem.theSixthYear;
                        }
                        return "0";
                    }
                },
                editor: function (container, options) {
                    $('<input  required data-required-msg="必输" name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoNumericTextBox({
                            min: 0,
                            step: 0.01
                        }).data("kendoNumericTextBox");
                }
            },
            //第七年
            {
                field: "theSeventhYear",
                title: '<@spring.message "CmnBasic.theSeventhYear"/>',
                width: 120,
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                },
                template:function (dataItem) {
                    if(dataItem.priceType=="PERCENTAGE"){
                        return toFixed(dataItem.theSeventhYear*100,2) + "%";
                    }else {
                        if(dataItem.theSeventhYear){
                            return dataItem.theSeventhYear;
                        }
                        return "0";
                    }
                },
                editor: function (container, options) {
                    $('<input  required data-required-msg="必输" name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoNumericTextBox({
                            min: 0,
                            step: 0.01
                        }).data("kendoNumericTextBox");
                }
            },
            //第八年
            {
                field: "theEightYear",
                title: '<@spring.message "CmnBasic.theEightYear"/>',
                width: 120,
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                },
                template:function (dataItem) {
                    if(dataItem.priceType=="PERCENTAGE"){
                        return toFixed(dataItem.theEightYear*100,2) + "%";
                    }else {
                        if(dataItem.theEightYear){
                            return dataItem.theEightYear;
                        }
                        return "0";
                    }
                },
                editor: function (container, options) {
                    $('<input  required data-required-msg="必输" name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoNumericTextBox({
                            min: 0,
                            step: 0.01
                        }).data("kendoNumericTextBox");
                }
            },
            //第九年
            {
                field: "theNinthYear",
                title: '<@spring.message "CmnBasic.theNinthYear"/>',
                width: 120,
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                },
                template:function (dataItem) {
                    if(dataItem.priceType=="PERCENTAGE"){
                        return toFixed(dataItem.theNinthYear*100,2) + "%";
                    }else {
                        if(dataItem.theNinthYear){
                            return dataItem.theNinthYear;
                        }
                        return "0";
                    }
                },
                editor: function (container, options) {
                    $('<input  required data-required-msg="必输" name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoNumericTextBox({
                            min: 0,
                            step: 0.01
                        }).data("kendoNumericTextBox");
                }
            },
            //第十年
            {
                field: "theTenthYear",
                title: '<@spring.message "CmnBasic.theTenthYear"/>',
                width: 120,
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                },
                template:function (dataItem) {
                    if(dataItem.priceType=="PERCENTAGE"){
                        return toFixed(dataItem.theTenthYear*100,2) + "%";
                    }else {
                        if(dataItem.theTenthYear){
                            return dataItem.theTenthYear;
                        }
                        return "0";
                    }
                },
                editor: function (container, options) {
                    $('<input  required data-required-msg="必输" name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoNumericTextBox({
                            min: 0,
                            step: 0.01
                        }).data("kendoNumericTextBox");
                }
            },
            //版本
            {
                field: "version",
                title: '<@spring.message "CmnBasic.version"/>',
                width: 80,
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                }
            },
            //有效期起
            {
                field: "effectiveStartDate",
                title: '<@spring.message "CmnBasic.effectiveStartDate"/>',
                width: 150,
                format: "{0:yyyy-MM-dd}",
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                },
                editor: function(container, options) {
                    var max = options.model.effectiveEndDate||undefined;
                    $('<input  required data-required-msg="必输" name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoDatePicker({
                            format:"yyyy-MM-dd",
                            max:max,
                            min:new Date(),
                            open: function() {
                                var maxChange = options.model.effectiveEndDate||undefined;
                                this.max(maxChange);
                            }
                        });
                }
            },
            //有效期至
            {
                field: "effectiveEndDate",
                title: '<@spring.message "CmnBasic.effectiveEndDate"/>',
                width: 150,
                format: "{0:yyyy-MM-dd}",
                attributes: {style: "text-align:center"},
                headerAttributes: {
                    style  : "text-align: center"
                },
                editor: function(container, options) {
                    var min = options.model.effectiveStartDate||undefined;
                    $('<input  required data-required-msg="必输" name="' + options.field + '"/>')
                        .appendTo(container)
                        .kendoDatePicker({
                            format:"yyyy-MM-dd",
                            min:min,
                            open: function() {
                                var minChange = options.model.effectiveStartDate||undefined;
                                this.min(minChange);
                            }
                        });
                }
            }
        ],
        editable: "inline"
    }).data('kendoGrid');
    Hap.autoResizeGrid("#Grid");
    
    function changePrd(options){
    	
    	$("input[name='contributionPeriod']").data("kendoLov").enable(true);
    	options.model.set('contributionPeriod',null);
    	options.model.set('sublineItemName',null);
    	$("input[name='currency']").data("kendoDropDownList").enable(true);
    	$("input[name='payMethod']").data("kendoDropDownList").enable(true);
    	//供款期 
      $("input[name='contributionPeriod']").kendoLov($.extend(<@lov "CMN_SUBLINE"/>, 
       {
            textField: 'sublineItemName',
            model    : options.model,
            select:function(e){
            	options.model.set('sublineItemName',e.item.sublineItemName);
            }
        },
        {
        	query: function (e) {
               e.param['itemId'] = options.model.setItemId;
             }
        }));
      //币种查询
                     $.ajax({
                         type:"POST",
                         async:false,
                         url:"${base.contextPath}/fms/pln/plan/library/queryCurrencyByItem",
                         data:{"itemId":options.model.setItemId,"code":"PUB.CURRENCY"},
                         dataType : 'json',
                         success: function(e) {
                        	 $("input[name='currency']").data("kendoDropDownList").setDataSource(e.rows);
                         }
                     });
                        	//缴费方式
                             $.ajax({
                                 type:"POST",
                                 async:false,
                                 url:"${base.contextPath}/fms/pln/plan/library/queryPaymethodByItem",
                                 data:{"itemId":options.model.setItemId},
                                 dataType : 'json',
                                 success: function(e) {
                                	 $("input[name='payMethod']").data("kendoDropDownList").setDataSource(e.rows);
                                 }
                             });
      
    }
</script>
</body>
</html>